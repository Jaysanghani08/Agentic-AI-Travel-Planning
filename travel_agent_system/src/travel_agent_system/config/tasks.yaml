# Travel Agent System - Collaborative task definitions
# Variables from crew.kickoff(inputs={...}):
# {user_input}, {origin}, {destination}, {travel_dates}, {days}, {style}, {budget}, {interests}
# {shortlist_from_scout}, {human_approval}, {previous_final_plan}

intent_analysis:
  description: >
    Parse the raw input "{user_input}" to extract structured travel parameters:
    - Origin (city or airport code, when present).
    - Destination (city or airport code, when present).
    - Travel dates (exact or relative). Normalize relative phrases like "next weekend"
      to concrete dates when possible.
    - Number of days.
    - Budget (amount and currency, or range).
    - Travel style (e.g., luxury, budget, culture, food, adventure).
    - Interests.
    Do not invent missing values. If a field is not present in input, return it as null.
  expected_output: >
    A strict JSON object only (no prose, no markdown) with keys:
    "origin", "destination", "start_or_dates", "days", "budget", "style", "interests",
    "reasoning". "budget" can be a string or an object with "amount" and "currency".
    Use null for unknown values.
  agent: orchestrator

research_discovery:
  description: >
    Use your expertise to find 3–5 local activities and "insider tips" for {destination}
    that match the traveler's style. Focus on authentic, non-touristy experiences
    (e.g., from Reddit, local blogs). For each activity or tip, provide a brief
    description and source. Output MUST be a shortlist formatted for human approval—
    do not proceed as if approved; present the shortlist clearly so a human can
    approve or reject items before logistics are booked.
    Trip context for selection:
    - Origin: {origin}
    - Destination: {destination}
    - Travel dates/start: {travel_dates}
    - Number of days: {days}
    - Budget: {budget}
    - Style: {style}
    - Interests: {interests}
    Include a "reasoning" field explaining why these activities were chosen and
    how they align with the traveler's style and destination.
  expected_output: >
    A shortlist of 3–5 activities and insider tips for {destination}, each with
    name, description, and source. Format suitable for human approval (e.g., numbered
    list with clear accept/skip hooks). Include a "reasoning" field: why these
    activities were selected and how they fit the traveler's profile.
  agent: scout

logistics_sourcing:
  description: >
    The traveler has approved (or given feedback on) the following activity shortlist from the Scout:

    {shortlist_from_scout}

    Approval or feedback from the traveler: {human_approval}
    Previous final itinerary (if this is a refinement pass): {previous_final_plan}

    Trip context:
    - Origin: {origin}
    - Destination: {destination}
    - Travel dates/start: {travel_dates}
    - Number of days: {days}
    - Budget: {budget}
    - Style: {style}
    - Interests: {interests}

    If {previous_final_plan} is present, treat {human_approval} as a refinement request
    and revise the previous itinerary directly instead of restarting from scratch.
    Using the above shortlist and trip context, find live flight and hotel options for the trip with direct booking URLs.
    Use only real, verifiable APIs or sources—do not invent or hallucinate links.
    Every URL must be a genuine booking link (e.g., from Amadeus or official
    airline/hotel sites). If a direct URL is unavailable for an option, state
    "URL not available" rather than fabricating one.
    Include a "reasoning" field explaining how you selected options (e.g., best
    price vs. convenience, layover trade-offs) and why each link is reliable.
  expected_output: >
    Flight and hotel options with: provider name, price, key details (dates, times,
    class/room type), and direct booking URLs only when verifiable. No hallucinated
    links. Include a "reasoning" field explaining selection criteria and link
    verification (e.g., saving cost vs. time, why this route was chosen).
  agent: logistician

audit_optimization:
  description: >
    The approved shortlist and traveler feedback are already incorporated in the logistics plan below.
    Previous final itinerary (if available): {previous_final_plan}
    Trip context:
    - Origin: {origin}
    - Destination: {destination}
    - Travel dates/start: {travel_dates}
    - Number of days: {days}
    - Style: {style}
    - Interests: {interests}
    If a previous final itinerary exists, verify the revised plan against the requested
    changes in {human_approval} and keep unchanged parts stable unless a change is needed.
    Verify that the total cost of the proposed itinerary is under the budget of
    {budget} and that travel times (flights, transfers, check-in/out) are realistic.
    Cross-check for schedule conflicts and suggest small optimizations if needed.
    Include a "reasoning" field: explain why specific choices were made (e.g.,
    saving cost vs. time, trade-offs between convenience and budget).
    Edge case: If the budget of {budget} is mathematically impossible for the
    requested destination, dates, or stay type, do NOT fail silently. Provide a
    clear notification that the budget is insufficient and suggest specific
    alternatives (e.g., different dates, shorter stay, different accommodation
    type, or nearby cheaper destination) instead of forcing an invalid plan.
  expected_output: >
    An audit report with: (1) total cost vs. budget (pass/fail), (2) travel time
    realism check, (3) any schedule conflicts or optimization suggestions,
    (4) a "reasoning" field explaining why this specific route/plan was chosen
    (e.g., saving cost vs. time). If budget is impossible: a clear notification
    plus concrete alternative suggestions (dates, stay type, or destination)—
    no silent failure.
  agent: auditor
